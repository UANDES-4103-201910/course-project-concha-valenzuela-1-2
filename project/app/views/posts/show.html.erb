<div id="kconteiner">
	<div class = "box-posts box-posts2">
		<div class = "edit-destroy">
			<% if @post.close == true && @post.unresolved == false %>
				<span class="glyphicon glyphicon-check"></span> Solved
				|
			<% end %>

			<% if @post.close == true %>
				Closed
			<% else %>
				Opened
			<% end %>
			<% if (current_user != nil) && ((current_user[:adm] == true) || User.find(@post.user_id)[:id] == current_user.id) %>
				| 
	      		<span class="glyphicon glyphicon-edit" style= "color:#FF5757"></span> <%= link_to 'Edit', edit_post_path(@post)%>
			<% end %>
			<% if (current_user != nil) && (current_user[:adm] == true) && (@post[:inappropriate] == false) %>
				| 
                <span class="glyphicon glyphicon-ban-circle" style= "color:#FF5757"></span> <%= link_to 'Ban',post_dumpsters_path(@post), 
                    method: :create,
                    data: { confirm: 'Are you sure you want to send this post to the Dumpster?' }  %>
            <% end %>
            <% if (current_user != nil) && (current_user[:adm] == true) && (@post[:inappropriate] == true) %>
				| 
                <span class="glyphicon glyphicon-check" style= "color:#FF5757"></span> <%= link_to 'Appropriate',dumpster_path(Dumpster.find_by(post_id: @post.id)), 
                    method: :delete,
                    data: { confirm: 'Are you sure you want to mark this post as Appropriate?' }  %>
            <% end %>
			<% if (current_user != nil) && ((current_user[:adm] == true) || User.find(@post.user_id)[:id] == current_user.id) %>
				| 
	      		<span class="glyphicon glyphicon-trash" style= "color:#FF5757"></span> <%= link_to 'Delete', post_path(@post),
                    method: :delete,
                    data: { confirm: 'Are you sure you want to delete this post?' }%>
			<% end %>
		</div>
		<h3>
			<div class = "titles">
				<strong></strong>
				<%= @post.title %>

			</div>
		</h3>
		<h5>
			<% if @post.inappropriate == true%>
				(In the Dumpster)
			<% end %>
		</h5>


		<p>
			<strong></strong>
			<a href= <%="http://localhost:3000/users/"+User.find(@post.user_id)[:id].to_s%> ><%= User.find(@post.user_id)[:name] %></a> | 
			<%= @post.city %>, <%= @post.country %> | 
			<%= @post.created_at.strftime( '%d/%m/%Y %H:%M' )%>
		</p>
		<p>
			<% if (current_user != nil) && (current_user[:status] == true) && (@post.inappropriate == false) && (User.find(@post.user_id)[:id] != current_user.id) %> 
				<% if Follower.find_by(user_id: current_user.id, post_id: @post.id) != nil %>
					<span class="glyphicon glyphicon-user" style= "color:#FF5757"></span> <%= link_to 'Unfollow', post_follower_path(@post), method: :delete %>
				<% else %>
		            <span class="glyphicon glyphicon-user" style= "color:#FF5757"></span> <%= link_to 'Follow', post_followers_path(@post), method: :create %>
		        <% end %>

		        | 
		        <% if Share.find_by(user_id: current_user.id, post_id: @post.id) != nil %>
		        	<span class="glyphicon glyphicon-share"></span> Shared
		        <% else %>
		        	<span class="glyphicon glyphicon-share" style= "color:#FF5757"></span> <%= link_to 'Share', post_shares_path(@post), method: :create %>
		        <% end %>
			<% end %>  
		</p>
		

		<p>
			<div class = "description">
				<strong><%= @post.description %></strong>
			</div>
		</p>

		<p>
			<div class = "image-post">
				<img alt="Image not found" width="200" height="200" src= <%= @post.images %>/>
			</div>

		</p>
		<% if (current_user != nil) && (current_user[:adm] == true || User.find(@post.user_id)[:id] == current_user.id) && (@post[:close] == true) && (@post[:unresolved] == true) %>
			<strong>Already Solved?</strong>
            <%= link_to 'Click here',post_path(@post, post:{unresolved: false}), 
                method: :put %>
        <% end %>
		

		<p>
			<%= @post.file %>
		</p>
	</div><br>
	<div class = "box-comments box-comments2" >

		<% contador1 = 0 %>
		<% for like in Like.all do %>
			<% if like.post_id == @post.id %>
				<% contador1 += 1 %>
			<% end %>
		<% end %>

		<% contador2 = 0 %>
		<% for dislike in Dislike.all do %>
			<% if dislike.post_id == @post.id %>
				<% contador2 += 1 %>
			<% end %>
		<% end %>

		<br>
		<p> 
			<%=contador1%>
			<% if current_user != nil && (@post.inappropriate == false) %>
	            <% if Like.find_by(user_id: current_user.id, post_id: @post.id) != nil %>
		            <%= link_to post_like_path(@post), method: :delete do %>
		                  <span class="glyphicon glyphicon-thumbs-up"></span>
		            <% end %>
	            <% elsif Dislike.find_by(user_id: current_user.id, post_id: @post.id) != nil %>      
	            	<span class="glyphicon glyphicon-thumbs-up"></span>
	            <% else %>
	            	<%= link_to post_likes_path(@post), method: :create do %>
		                  <span class="glyphicon glyphicon-thumbs-up"></span>
		            <% end %>
	            <% end %>
            <% else %>
            	<span class="glyphicon glyphicon-thumbs-up"></span>
            <% end %>

            |
            <%=contador2%>
            <% if current_user != nil && (@post.inappropriate == false)%>
	            <% if Dislike.find_by(user_id: current_user.id, post_id: @post.id) != nil %>
		            <%= link_to post_dislike_path(@post), method: :delete do %>
		                  <span class="glyphicon glyphicon-thumbs-down"></span>
		            <% end %>
	            <% elsif Like.find_by(user_id: current_user.id, post_id: @post.id) != nil %>      
	            	<span class="glyphicon glyphicon-thumbs-down"></span>
	            <% else %>
	            	<%= link_to post_dislikes_path(@post), method: :create do %>
		                  <span class="glyphicon glyphicon-thumbs-down"></span>
		            <% end %>
	            <% end %>
            <% else %>
            	<span class="glyphicon glyphicon-thumbs-down"></span>
            <% end %>
        </p>
        <p>
            <% if (current_user != nil) && (current_user[:status] == true) && (@post.inappropriate == false)%>
				  <span class="glyphicon glyphicon-warning-sign" style= "color:#FF5757"></span> <%= link_to 'Inappropriate', new_post_inappropriate_content_path(@post) %>
			<% end %>
		</p>

		<% if @post.close == false && (@post.inappropriate == false)%>
			<% if !(current_user == nil) && !(current_user[:status] == false) %>
				<div class = "box-comments-grey">
					<%= form_with(model: [@post, @post.comments.build], local: true) do |form| %>
						<p>
						    <%= form.label :description, "Add a comment" %><br>
						    <strong><%= form.text_area :description %></strong>
					    </p>
					    <p>
					    	<%= form.submit "Enter" %>
					    </p>
					<% end %>
				</div>
			<% end %>
			<div class = "box-comments-grey">
				<% for comment in Comment.all.sort.reverse do %>
					<% if comment.post_id == @post.id %>
						<p>
	      					<span class=" glyphicon glyphicon-comment"></span> <%= User.find(comment[:user_id])[:name] %> | <strong><%= comment.created_at.strftime( '%d/%m/%Y %H:%M' )%></strong>
	      					<% if current_user != nil && current_user.id == comment.user_id %>
	      						| <%= link_to 'Delete', [comment.post, comment],
					               method: :delete,
					               data: { confirm: 'Are you sure you want to delete this comment?' } %>
				            <% end %>
						</p>
						<p>	
							<strong><%= comment[:description] %></strong>
						</p>					
						<br>
					<% end %>
				<% end %>
			</div>
		<% end %>
	</div>
</div>

